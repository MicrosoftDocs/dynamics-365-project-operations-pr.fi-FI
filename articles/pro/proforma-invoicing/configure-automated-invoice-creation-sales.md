---
title: Automaattisen laskun luonnin määrittäminen
description: Tässä aiheessa on tietoja proformalaskujen automaattisen luomisen määrittämisestä.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: fi-FI
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866813"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="49c12-103">Automaattisen laskun luonnin määrittäminen</span><span class="sxs-lookup"><span data-stu-id="49c12-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="49c12-104">_**Koskee:** Lite-käyttöönotto - kaupasta proformalaskutukseen, Project Operationsin resurssiin/ei-varastointiin perustuvia skenaarioita_</span><span class="sxs-lookup"><span data-stu-id="49c12-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="49c12-105">Voit määrittää automaattisen laskun luonnin Dynamics 365 Project Operationsissa.</span><span class="sxs-lookup"><span data-stu-id="49c12-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="49c12-106">Järjestelmä luo proformalaskun, joka perustuu kunkin projektisopimuksen ja sopimusrivin laskuaikatauluun.</span><span class="sxs-lookup"><span data-stu-id="49c12-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="49c12-107">Laskuaikataulut määritetään sopimusrivin tasolla.</span><span class="sxs-lookup"><span data-stu-id="49c12-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="49c12-108">Kullakin palvelusopimuksen rivillä voi olla erillinen laskuaikataulu, tai sama laskuaikataulu voidaan sisällyttää palvelusopimuksen jokaiseen riviin.</span><span class="sxs-lookup"><span data-stu-id="49c12-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="49c12-109">Kun luot laskun, järjestelmä luo aina vähintään yhden laskun projektisopimusta kohden.</span><span class="sxs-lookup"><span data-stu-id="49c12-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="49c12-110">Joissakin tapauksissa voidaan luoda useita laskuja.</span><span class="sxs-lookup"><span data-stu-id="49c12-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="49c12-111">Jos palvelusopimuksessa on esimerkiksi useita asiakkaita, samalla luodaan sama määrä laskuja kuin niiden asiakkaiden määrä, joilla on laskutettavia tapahtumia kyseisessä projektisopimuksessa.</span><span class="sxs-lookup"><span data-stu-id="49c12-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="49c12-112">Tietoja siitä, miten tapahtumat sisällytetään laskuun</span><span class="sxs-lookup"><span data-stu-id="49c12-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="49c12-113">Joskus kukin projektipohjainen sopimusrivi määrittää erillisen laskun aikataulun.</span><span class="sxs-lookup"><span data-stu-id="49c12-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="49c12-114">Esimerkiksi Adatum-palvelusopimuksen toteutuspalveluilla on seuraavat sopimusrivit:</span><span class="sxs-lookup"><span data-stu-id="49c12-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="49c12-115">Kiinteähintainen prototyyppityö, jossa on kaksi manuaalisesti luotua välitavoitetta.</span><span class="sxs-lookup"><span data-stu-id="49c12-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="49c12-116">Toteutustyöt, jotka sisältävät aikaa ja laskutetaan kahden viikon välein maanantaisin.</span><span class="sxs-lookup"><span data-stu-id="49c12-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="49c12-117">Aiheutuneet kulut, jotka on laskutettava kuukausittain kunkin kuukauden ensimmäisenä maanantaina.</span><span class="sxs-lookup"><span data-stu-id="49c12-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="49c12-118">Kummallekin riville määritetyt laskuaikataulut näyttävät seuraavalta taulukolta:</span><span class="sxs-lookup"><span data-stu-id="49c12-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="49c12-119">Palvelusopimuksen rivi</span><span class="sxs-lookup"><span data-stu-id="49c12-119">Contract line</span></span> | <span data-ttu-id="49c12-120">Laskun suorituspäivä</span><span class="sxs-lookup"><span data-stu-id="49c12-120">Invoice run date</span></span> | <span data-ttu-id="49c12-121">Tapahtuman katkaisupäivämäärä</span><span class="sxs-lookup"><span data-stu-id="49c12-121">Transaction cut-off date</span></span> | <span data-ttu-id="49c12-122">Välitavoitteen päivämäärä</span><span class="sxs-lookup"><span data-stu-id="49c12-122">Milestone date</span></span> | <span data-ttu-id="49c12-123">Välitavoitteen summa</span><span class="sxs-lookup"><span data-stu-id="49c12-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="49c12-124">Prototyyppityö</span><span class="sxs-lookup"><span data-stu-id="49c12-124">Prototype work</span></span> | <span data-ttu-id="49c12-125">5. lokakuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-125">October 5, Monday</span></span> | - | <span data-ttu-id="49c12-126">5. lokakuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-126">October 5, Monday</span></span> | <span data-ttu-id="49c12-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="49c12-127">5000 USD</span></span> |
| - | <span data-ttu-id="49c12-128">3. marraskuuta, tiistai</span><span class="sxs-lookup"><span data-stu-id="49c12-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="49c12-129">3. marraskuuta, tiistai</span><span class="sxs-lookup"><span data-stu-id="49c12-129">November 3, Tuesday</span></span> | <span data-ttu-id="49c12-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="49c12-130">12,000 USD</span></span> |
| <span data-ttu-id="49c12-131">Käyttöönottotyö</span><span class="sxs-lookup"><span data-stu-id="49c12-131">Implementation work</span></span> | <span data-ttu-id="49c12-132">5. lokakuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-132">October 5, Monday</span></span> | <span data-ttu-id="49c12-133">4. lokakuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="49c12-134">19. lokakuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-134">October 19, Monday</span></span> | <span data-ttu-id="49c12-135">18. lokakuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="49c12-136">2. marraskuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-136">November 2, Monday</span></span> | <span data-ttu-id="49c12-137">1. marraskuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="49c12-138">16. marraskuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-138">November 16, Monday</span></span> | <span data-ttu-id="49c12-139">15. marraskuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="49c12-140">Aiheutuneet kulut</span><span class="sxs-lookup"><span data-stu-id="49c12-140">Expenses incurred</span></span> | <span data-ttu-id="49c12-141">5. lokakuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-141">October 5, Monday</span></span> | <span data-ttu-id="49c12-142">4. lokakuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="49c12-143">2. marraskuuta, maanantai</span><span class="sxs-lookup"><span data-stu-id="49c12-143">November 2, Monday</span></span> | <span data-ttu-id="49c12-144">1. marraskuuta, sunnuntai</span><span class="sxs-lookup"><span data-stu-id="49c12-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="49c12-145">Tässä esimerkissä, jossa automaattinen laskutus suoritetaan:</span><span class="sxs-lookup"><span data-stu-id="49c12-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="49c12-146">**4. lokakuuta tai mikä tahansa päivämäärä ennen sitä**: Tälle sopimukselle ei ole luotu laskua, koska kunkin sopimusrivin **laskuaikataulutaulukkoa** ei kutsuta pois sunnuntaina 4. lokakuuta laskun suorituspäivänä.</span><span class="sxs-lookup"><span data-stu-id="49c12-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="49c12-147">**5. lokakuuta, maanantai**: Yksi lasku luodaan:</span><span class="sxs-lookup"><span data-stu-id="49c12-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="49c12-148">Välitavoitteen sisältävä prototyyppityö, jos se on merkitty **Valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="49c12-149">Käyttöönottotyöt, jotka sisältävät kaikki aikatapahtumat, jotka on luotu ennen tapahtuman katkaisupäivää sunnuntai lokakuun 4., joka on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="49c12-150">Aiheutuneet kulut, jotka sisältävät kaikki kulutapahtumat, jotka on luotu ennen tapahtuman katkaisupäivää sunnuntai lokakuun 4., joka on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="49c12-151">**6. lokakuuta tai mikä tahansa päivämäärä ennen 19. lokakuuta**: Tälle sopimukselle ei ole luotu laskua, sillä kunkin sopimusrivin **laskuaikataulutaulukkoa** ei kutsuta pois sunnuntaina 6. lokakuuta tai minä tahansa päivämääränä ennen 19. lokakuuta laskun suorituspäivänä.</span><span class="sxs-lookup"><span data-stu-id="49c12-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="49c12-152">**19. lokakuuta, maanantai**: Käyttöönottotöistä luodaan yksi lasku, joka sisältää ennen tapahtuman katkaisupäivää sunnuntaita lokakuun 18. luodut kaikki aikatapahtumat, jotka on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="49c12-153">**2. marraskuuta, maanantai**: Yksi lasku luodaan:</span><span class="sxs-lookup"><span data-stu-id="49c12-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="49c12-154">Käyttöönottotyöt, jotka sisältävät kaikki aikatapahtumat, jotka on luotu ennen tapahtuman katkaisupäivää sunnuntai marraskuun 1., joka on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="49c12-155">Aiheutuneet kulut, jotka sisältävät kaikki kulutapahtumat, jotka on luotu ennen tapahtuman katkaisupäivää sunnuntai marraskuun 1., joka on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="49c12-156">**3. marraskuuta, tiistai**: Yksi lasku luodaan prototyyppityölle, joka sisältää 12 000 USD:n välitavoitteen, jos se on merkitty **valmiiksi laskutettavaksi**.</span><span class="sxs-lookup"><span data-stu-id="49c12-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="49c12-157">Määritä automaattinen laskutus</span><span class="sxs-lookup"><span data-stu-id="49c12-157">Configure automatic invoicing</span></span>

<span data-ttu-id="49c12-158">Automaattinen laskujen luominen määritetään suorittamalla seuraavat vaiheet.</span><span class="sxs-lookup"><span data-stu-id="49c12-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="49c12-159">Siirry **Project Operations** -toiminnossa kohtaan **Asetukset** > **Toistuvan laskun määrittäminen**.</span><span class="sxs-lookup"><span data-stu-id="49c12-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="49c12-160">Luo erätyö ja anna sille nimeksi **Project Operationsin laskujen luominen**.</span><span class="sxs-lookup"><span data-stu-id="49c12-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="49c12-161">Erätyön nimessä on oltava sanat "laskujen luominen".</span><span class="sxs-lookup"><span data-stu-id="49c12-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="49c12-162">Valitse **Työtyyppi**-kentässä **Ei mitään**.</span><span class="sxs-lookup"><span data-stu-id="49c12-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="49c12-163">Kenttien **Päivittäin** ja **On aktiivinen** oletusarvo on **Kyllä**.</span><span class="sxs-lookup"><span data-stu-id="49c12-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="49c12-164">Valitse **Suorita työnkulku**.</span><span class="sxs-lookup"><span data-stu-id="49c12-164">Select **Run Workflow**.</span></span> <span data-ttu-id="49c12-165">**Valitse tietue** -valintaikkunassa näkyy kolme työnkulkua:</span><span class="sxs-lookup"><span data-stu-id="49c12-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="49c12-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="49c12-166">ProcessRunCaller</span></span>
- <span data-ttu-id="49c12-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="49c12-167">ProcessRunner</span></span>
- <span data-ttu-id="49c12-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="49c12-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="49c12-169">Valitse **ProcessRunCaller** ja sitten **Lisää**.</span><span class="sxs-lookup"><span data-stu-id="49c12-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="49c12-170">Valitse seuraavassa valintaikkunassa **OK**.</span><span class="sxs-lookup"><span data-stu-id="49c12-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="49c12-171">**Lepo**-työnkulkua seuraa **Käsittely**-työnkulku.</span><span class="sxs-lookup"><span data-stu-id="49c12-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="49c12-172">Vaiheessa 5 voit myös valita **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="49c12-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="49c12-173">Kun tämän jälkeen valitset **OK**, **Käsittely**-työnkulkua seuraa **Lepo**-työnkulku.</span><span class="sxs-lookup"><span data-stu-id="49c12-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="49c12-174">Työnkulut **ProcessRunCaller** ja **ProcessRunner** luovat laskuja.</span><span class="sxs-lookup"><span data-stu-id="49c12-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="49c12-175">Työnkulku **ProcessRunCaller** kutsuu työnkulun **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="49c12-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="49c12-176">**ProcessRunner** on se työnkulku, joka tosiasiassa luo laskut.</span><span class="sxs-lookup"><span data-stu-id="49c12-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="49c12-177">Työnkulku käy läpi kaikki sopimusrivit, joille on luotava lasku, ja luo kyseiset laskut.</span><span class="sxs-lookup"><span data-stu-id="49c12-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="49c12-178">Työnkulku tarkistaa sopimusrivien laskujen suorituspäiviä määrittääkseen ne sopimusrivit, joille on luotava laskuja.</span><span class="sxs-lookup"><span data-stu-id="49c12-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="49c12-179">Jos yhteen sopimukseen kuuluvilla sopimusriveillä on sama laskujen suorituspäivä, tapahtumat yhdistetään yhteen laskuun, jolla on kaksi laskutusriviä.</span><span class="sxs-lookup"><span data-stu-id="49c12-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="49c12-180">Jos laskujen luomista edellyttäviä tapahtumia ei ole, työnkulku ohittaa laskujen luonnin.</span><span class="sxs-lookup"><span data-stu-id="49c12-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="49c12-181">Kun **ProcessRunner** on valmis, se kutsuu työnkulun **ProcessRunCaller**, antaa päättymisajan ja sulkeutuu.</span><span class="sxs-lookup"><span data-stu-id="49c12-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="49c12-182">**ProcessRunCaller** käynnistää sitten ajastimen, joka kestää 24 tuntia määritetystä päättymisajasta eteenpäin.</span><span class="sxs-lookup"><span data-stu-id="49c12-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="49c12-183">Ajastimen loputtua, **ProcessRunCaller** sulkeutuu.</span><span class="sxs-lookup"><span data-stu-id="49c12-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="49c12-184">Laskujen luomisen erätyö on toistuva työ.</span><span class="sxs-lookup"><span data-stu-id="49c12-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="49c12-185">Jos tämä erätyö suoritetaan useita kertoja, siitä luodaan useita esiintymiä, mikä voi aiheuttaa virheitä.</span><span class="sxs-lookup"><span data-stu-id="49c12-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="49c12-186">Siksi erätyö kannatta käynnistää vain kerran ja käynnistää uudelleen vain, jos se pysähtyy.</span><span class="sxs-lookup"><span data-stu-id="49c12-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="49c12-187">Erälaskutus suoritetaan vain sellaisille Project Operations -toiminnoille, jotka on määritetty laskun aikataulun mukaan.</span><span class="sxs-lookup"><span data-stu-id="49c12-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="49c12-188">Jos sopimusrivillä on kiinteähintainen laskutusmenetelmä, sillä on oltava määritettyinä välitavoitteet.</span><span class="sxs-lookup"><span data-stu-id="49c12-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="49c12-189">Jos projektisopimusrivillä on aika- ja materiaalipohjainen laskutusmenetelmä, sille on määritettävä päivämäärään perustuva laskutusaikataulu.</span><span class="sxs-lookup"><span data-stu-id="49c12-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
